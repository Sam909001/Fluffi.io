// Fluffi Presale and Staking Full Site Structure
// Framework: React + TailwindCSS + Wagmi + ethers.js (for wallet connect and tx handling)

import React, { useState, useEffect } from 'react';
import { WagmiConfig, createClient, configureChains, mainnet } from 'wagmi';
import { publicProvider } from 'wagmi/providers/public';
import { ConnectKitProvider, getDefaultClient } from 'connectkit';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { ethers } from 'ethers';
import FluffiLogo from './assets/fluffi-logo.png'; // Use uploaded logo file

const TOTAL_SUPPLY = 10_000_000_000;
const PRESALE_SUPPLY = 0.4 * TOTAL_SUPPLY;
const STAKING_SUPPLY = 0.2 * TOTAL_SUPPLY;
const PRESALE_DURATION = 30 * 24 * 60 * 60 * 1000; // 30 days in ms
const STAGE_DURATION = 48 * 60 * 60 * 1000; // 48 hours in ms
const STAGE_COUNT = 15;
const INITIAL_PRICE = 0.0001;
const LISTING_PRICE = 0.002;
const REFERRAL_BONUS = 0.1; // 10%
const STAKING_APY = 0.9; // 90%
const WALLET_ADDRESS = "0xFc3381a6AA1d134DDf22f641E97c92C400959910";

const client = createClient(
  getDefaultClient({
    appName: 'Fluffi Token',
    chains: [mainnet],
    provider: publicProvider(),
  })
);

const getCurrentStage = (startTime) => {
  const now = Date.now();
  const elapsed = now - startTime;
  return Math.min(Math.floor(elapsed / STAGE_DURATION), STAGE_COUNT - 1);
};

const getStagePrice = (stage) => INITIAL_PRICE * Math.pow(1.05, stage);

const App = () => {
  const [presaleStart, setPresaleStart] = useState(Date.now());
  const [currentStage, setCurrentStage] = useState(0);
  const [price, setPrice] = useState(INITIAL_PRICE);

  useEffect(() => {
    const interval = setInterval(() => {
      const stage = getCurrentStage(presaleStart);
      setCurrentStage(stage);
      setPrice(getStagePrice(stage));
    }, 10000);
    return () => clearInterval(interval);
  }, [presaleStart]);

  return (
    <WagmiConfig client={client}>
      <ConnectKitProvider>
        <div className="min-h-screen bg-gradient-to-b from-pink-50 to-yellow-100 text-gray-900">
          <header className="flex items-center justify-between p-4 shadow-md">
            <div className="flex items-center gap-2">
              <img src={FluffiLogo} alt="$FLUFFI" className="h-10 w-10" />
              <h1 className="text-xl font-bold">$FLUFFI</h1>
            </div>
            <ConnectKitProvider />
          </header>

          <main className="grid grid-cols-1 md:grid-cols-2 gap-6 p-6">
            <Card>
              <CardContent>
                <h2 className="text-lg font-semibold">Presale Live</h2>
                <p>Stage {currentStage + 1} / {STAGE_COUNT}</p>
                <p>Current Price: ${price.toFixed(6)} USDT</p>
                <BuyForm price={price} />
                <ReferralInfo />
              </CardContent>
            </Card>

            <Card>
              <CardContent>
                <h2 className="text-lg font-semibold">Stake Your $FLUFFI</h2>
                <StakingSection />
              </CardContent>
            </Card>
          </main>

          <footer className="p-4 text-center text-sm text-gray-600">
            <p>Telegram: <a href="https://t.me/FLUFFISOLANALAYER2" className="text-blue-600">t.me/FLUFFISOLANALAYER2</a></p>
            <p>Twitter: <a href="https://x.com/FLUFFIOFFICIAL" className="text-blue-600">@FLUFFIOFFICIAL</a></p>
          </footer>
        </div>
      </ConnectKitProvider>
    </WagmiConfig>
  );
};

const BuyForm = ({ price }) => {
  const [amount, setAmount] = useState('');
  const [referral, setReferral] = useState('');

  const handleBuy = () => {
    // Implement wallet buy function
    alert(`Buying ${amount} worth of $FLUFFI with referral ${referral}`);
  };

  return (
    <div className="space-y-2">
      <input
        className="w-full border p-2"
        type="number"
        placeholder="Amount in USD"
        value={amount}
        onChange={(e) => setAmount(e.target.value)}
      />
      <input
        className="w-full border p-2"
        type="text"
        placeholder="Referral address (optional)"
        value={referral}
        onChange={(e) => setReferral(e.target.value)}
      />
      <Button onClick={handleBuy} className="w-full bg-pink-500 hover:bg-pink-600 text-white">
        Buy Now
      </Button>
    </div>
  );
};

const ReferralInfo = () => (
  <div className="mt-4 text-sm text-gray-700">
    Refer friends and earn <strong>10%</strong> bonus in tokens on their purchase!
  </div>
);

const StakingSection = () => {
  const [stakeAmount, setStakeAmount] = useState('');

  const handleStake = () => {
    alert(`Staking ${stakeAmount} $FLUFFI with 90% APY`);
  };

  return (
    <div className="space-y-2">
      <input
        className="w-full border p-2"
        type="number"
        placeholder="Amount to stake"
        value={stakeAmount}
        onChange={(e) => setStakeAmount(e.target.value)}
      />
      <Button onClick={handleStake} className="w-full bg-yellow-500 hover:bg-yellow-600 text-white">
        Stake
      </Button>
      <p className="text-xs text-gray-600">Staking ends on listing date. Rewards: 90% APY</p>
    </div>
  );
};

export default App;
