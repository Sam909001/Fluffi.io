<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fluffi Token Presale</title>
</head>
<body>
  <h2>Buy FLUFFI Tokens</h2>

  <label for="bnbAmount">BNB Amount:</label>
  <input type="text" id="bnbAmount" placeholder="e.g. 0.05" /><br><br>

  <label for="referral">Referral Address (optional):</label>
  <input type="text" id="referral" placeholder="0x... (optional)" /><br><br>

  <button id="buyButton">Buy FLUFFI</button>

  <script src="https://cdn.jsdelivr.net/npm/web3@1.10.3/dist/web3.min.js"></script>
  <script>
    window.addEventListener('load', async () => {
      if (typeof window.ethereum !== 'undefined') {
        const web3 = new Web3(window.ethereum);

        const contractAddress = "0x60A94bc12d0d4F782Fd597e5E1222247CFb7E297";
        const abi = [
          {
            "inputs": [
              { "internalType": "address", "name": "referrer", "type": "address" }
            ],
            "name": "contribute",
            "outputs": [],
            "stateMutability": "payable",
            "type": "function"
          }
        ];

        const contract = new web3.eth.Contract(abi, contractAddress);

        document.getElementById('buyButton').addEventListener('click', async () => {
          try {
            await window.ethereum.request({ method: 'eth_requestAccounts' });
            const accounts = await web3.eth.getAccounts();
            const userAddress = accounts[0];

            const bnbAmount = document.getElementById('bnbAmount').value;
            const referrerInput = document.getElementById('referral').value;
            const referrer = web3.utils.isAddress(referrerInput)
              ? referrerInput
              : "0x0000000000000000000000000000000000000000";

            if (!bnbAmount || isNaN(bnbAmount)) {
              alert("Please enter a valid BNB amount.");
              return;
            }

            const amountInWei = web3.utils.toWei(bnbAmount, 'ether');

            const tx = await contract.methods.contribute(referrer).send({
              from: userAddress,
              value: amountInWei
            });

            console.log("Transaction successful:", tx);
            alert("Success! You bought FLUFFI tokens.");
          } catch (err) {
            console.error("Transaction error:", err);
            alert("Transaction failed: " + err.message);
          }
        });
      } else {
        alert("MetaMask not detected. Please install it to continue.");
      }
    });
  </script>
</body>
</html>
