<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FLUFFI Token Presale</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>$FLUFFI Token Presale</h1>
  </header>

  <main>
    <section>
      <h2>Presale is Live!</h2>
      <button id="buyNowBtn">Buy Now</button>
      <p id="status"></p>
    </section>
  </main>

  <script>
    const PRESALE_ADDRESS = "0x60A94bc12d0d4F782Fd597e5E1222247CFb7E297";
    const TOKEN_PAYMENT_ADDRESS = "0x6F5f48A159Cd46a10faDEED95b29028972554747";

    const PRESALE_ABI = [
      {"inputs":[],"stateMutability":"nonpayable","type":"constructor"},
      {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":true,"internalType":"address","name":"referrer","type":"address"}],"name":"Contribution","type":"event"},
      {"anonymous":false,"inputs":[],"name":"PresaleEnded","type":"event"},
      {"inputs":[],"name":"RATE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"referrer","type":"address"}],"name":"contribute","outputs":[],"stateMutability":"payable","type":"function"},
      {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"contributions","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"endPresale","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"getContributorAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"presaleActive","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referrals","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
      {"inputs":[{"internalType":"address","name":"_token","type":"address"}],"name":"setTokenAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"inputs":[],"name":"tokenAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"totalRaised","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
      {"inputs":[],"name":"withdrawFunds","outputs":[],"stateMutability":"nonpayable","type":"function"},
      {"stateMutability":"payable","type":"receive"}
    ];

    async function buyTokens() {
      if (typeof window.ethereum === 'undefined') {
        alert('MetaMask not detected!');
        return;
      }

      const web3 = new Web3(window.ethereum);
      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
      const user = accounts[0];
      const referrer = new URLSearchParams(window.location.search).get('ref') || "0x0000000000000000000000000000000000000000";

      const contract = new web3.eth.Contract(PRESALE_ABI, PRESALE_ADDRESS);

      try {
        const valueInBNB = web3.utils.toWei('0.01', 'ether'); // Minimum amount
        document.getElementById('status').innerText = 'Processing...';

        await contract.methods.contribute(referrer).send({
          from: user,
          value: valueInBNB
        });

        document.getElementById('status').innerText = 'Purchase successful!';
      } catch (error) {
        console.error(error);
        document.getElementById('status').innerText = 'Transaction failed!';
      }
    }

    document.getElementById('buyNowBtn').addEventListener('click', buyTokens);
  </script>
</body>
</html>
