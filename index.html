const CONTRACT_ADDRESS = "0x60A94bc12d0d4F782Fd597e5E1222247CFb7E297";
const ABI = [
  {
    "inputs":[{"internalType":"address","name":"referrer","type":"address"}],
    "name":"contribute",
    "outputs":[],
    "stateMutability":"payable",
    "type":"function"
  }
];

// Connect wallet and trigger transaction
async function connectWalletAndBuy() {
  if (!window.ethereum) {
    alert("Please install MetaMask to continue.");
    return;
  }

  const web3 = new Web3(window.ethereum);

  try {
    await ethereum.request({ method: "eth_requestAccounts" });

    const accounts = await web3.eth.getAccounts();
    const user = accounts[0];

    const bnbAmount = document.getElementById("bnbAmount").value;
    const referrer = document.getElementById("referral").value || "0x0000000000000000000000000000000000000000";

    if (!bnbAmount || isNaN(bnbAmount) || Number(bnbAmount) <= 0) {
      alert("Please enter a valid BNB amount.");
      return;
    }

    const contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);
    const valueInWei = web3.utils.toWei(bnbAmount, 'ether');

    const tx = await contract.methods.contribute(referrer).send({
      from: user,
      value: valueInWei
    });

    alert("Success! Tokens will be claimable after listing.");
    console.log("Transaction successful:", tx.transactionHash);

  } catch (err) {
    console.error("Transaction failed:", err);
    alert("Transaction failed: " + err.message);
  }
}

// Bind to button
document.addEventListener("DOMContentLoaded", function () {
  document.getElementById("buyButton").addEventListener("click", connectWalletAndBuy);
});
